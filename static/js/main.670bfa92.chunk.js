(this.webpackJsonpzoombooth=this.webpackJsonpzoombooth||[]).push([[0],{164:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(58),i=n.n(c),o=n(75),u=n(28),s=n(250),l=n(78),d=n(215),j=n(52),b=Object(d.a)({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"},error:{main:j.a.A400},background:{default:"#fff"}}}),f=n(233),h=n(31),p=n(26),O=n.n(p),m=n(35),x=n(85),v=n(86),g=n(138),T=n(137),k=function(e){Object(g.a)(n,e);var t=Object(T.a)(n);function n(e){var r;return Object(x.a)(this,n),(r=t.call(this)).history=e,r}return Object(v.a)(n,[{key:"navigateInternal",value:function(){var e=Object(m.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.replace(window.location.origin,""),n.noHistory?this.history.replace(r):this.history.push(r),e.abrupt("return",!1);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(n(123).a),w=n(241),y=n(242),C=n(97),A=n(243),S=n(18),R=n(3),E=function(){var e=Object(h.d)().instance,t=Object(r.useState)(null),n=Object(S.a)(t,2),a=n[0],c=n[1],i=e.getActiveAccount();return Object(r.useEffect)((function(){c(i?i.name.split(" ")[0]:null)}),[i]),a?Object(R.jsxs)(C.a,{variant:"h6",children:["Welcome, ",a]}):null},I=n(234),D=n(230),M=n(227),z=n(84),B=window.navigator.userAgent,F=B.indexOf("MSIE "),L=B.indexOf("Trident/"),Y=B.indexOf("Edge/"),H=B.indexOf("Firefox"),N={auth:{clientId:"36bc0775-9527-484c-9c48-2e846090732b",authority:"https://login.microsoftonline.com/9c85420c-07ed-40e7-9c4c-4207556dc906",redirectUri:"",postLogoutRedirectUri:""},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:F>0||L>0||Y>0||H>0},system:{loggerOptions:{loggerCallback:function(e,t,n){if(!n)switch(e){case z.a.Error:return void console.error(t);case z.a.Info:return void console.info(t);case z.a.Verbose:return void console.debug(t);case z.a.Warning:return void console.warn(t);default:return}}}}},P={scopes:["User.Read","Calendars.ReadWrite"]},V="https://graph.microsoft.com/v1.0",Z=function(){var e=Object(h.d)().instance,t=Object(r.useState)(null),n=Object(S.a)(t,2),a=n[0],c=n[1],i=Boolean(a),o=function(t){c(null),"popup"===t?e.loginPopup(P):"redirect"===t&&e.loginRedirect(P)};return Object(R.jsxs)("div",{children:[Object(R.jsx)(I.a,{onClick:function(e){return c(e.currentTarget)},color:"inherit",children:"Login"}),Object(R.jsxs)(M.a,{id:"menu-appbar",anchorEl:a,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:i,onClose:function(){return c(null)},children:[Object(R.jsx)(D.a,{onClick:function(){return o("popup")},children:"Sign in using Popup"},"loginPopup"),Object(R.jsx)(D.a,{onClick:function(){return o("redirect")},children:"Sign in using Redirect"},"loginRedirect")]})]})},U=n(240),W=n(127),G=n.n(W),J=n(36),q=n(232),$=n(236),_=n(229),K=n(239),Q=n(222),X=n(238),ee=n(237),te=n(125),ne=n.n(te),re=n(126),ae=n.n(re),ce=function(e){var t=Object(h.d)(),n=t.instance,r=t.accounts,a=e.onClose,c=e.open,i=function(e){n.setActiveAccount(e),e?window.location.reload():n.loginRedirect(Object(J.a)(Object(J.a)({},P),{},{prompt:"login"})),a(e)};return Object(R.jsxs)(ee.a,{onClose:a,"aria-labelledby":"simple-dialog-title",open:c,children:[Object(R.jsx)(X.a,{id:"simple-dialog-title",children:"Set active account"}),Object(R.jsxs)($.a,{children:[r.map((function(e){return Object(R.jsxs)(_.a,{button:!0,onClick:function(){return i(e)},children:[Object(R.jsx)(K.a,{children:Object(R.jsx)(q.a,{children:Object(R.jsx)(ne.a,{})})}),Object(R.jsx)(Q.a,{primary:e.name,secondary:e.username})]},e.homeAccountId)})),Object(R.jsxs)(_.a,{autoFocus:!0,button:!0,onClick:function(){return i(null)},children:[Object(R.jsx)(K.a,{children:Object(R.jsx)(q.a,{children:Object(R.jsx)(ae.a,{})})}),Object(R.jsx)(Q.a,{primary:"Add account"})]})]})]})},ie=function(){var e=Object(h.d)().instance,t=Object(r.useState)(!1),n=Object(S.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(null),o=Object(S.a)(i,2),u=o[0],s=o[1],l=Boolean(u);return Object(R.jsxs)("div",{children:[Object(R.jsx)(U.a,{onClick:function(e){return s(e.currentTarget)},color:"inherit",children:Object(R.jsx)(G.a,{})}),Object(R.jsxs)(M.a,{id:"menu-appbar",anchorEl:u,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:l,onClose:function(){return s(null)},children:[Object(R.jsx)(D.a,{onClick:function(){return s(null),void c(!0)},children:"Switch Account"},"switchAccount"),Object(R.jsx)(D.a,{onClick:function(){return t="redirect",s(null),void("popup"===t?e.logoutPopup():"redirect"===t&&e.logoutRedirect());var t},children:"Logout using Redirect"},"logoutRedirect")]}),Object(R.jsx)(ce,{open:a,onClose:function(){c(!1)}})]})},oe=n(5),ue=function(){var e=Object(h.d)().inProgress;return Object(h.c)()?Object(R.jsx)(ie,{}):e!==oe.g.Startup&&e!==oe.g.HandleRedirect?Object(R.jsx)(Z,{}):null},se=n(225),le=Object(se.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1,"& a":{textDecoration:"none"}}}})),de=function(){var e=le();return Object(R.jsx)("div",{className:e.root,children:Object(R.jsx)(w.a,{position:"static",children:Object(R.jsxs)(y.a,{children:[Object(R.jsx)(C.a,{className:e.title,children:Object(R.jsx)(A.a,{component:o.b,to:"/",color:"inherit",variant:"h6",children:"SF Booth Booking"})}),Object(R.jsx)(E,{}),Object(R.jsx)(ue,{})]})})})},je=function(e){return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(de,{}),Object(R.jsx)("br",{}),Object(R.jsx)("br",{}),e.children]})},be=n(25);function fe(){var e=Object(h.d)().instance;return Object(r.useEffect)((function(){e.logoutRedirect({account:e.getActiveAccount(),onRedirectNavigate:function(){return!be.a.isInIframe()}})}),[e]),Object(R.jsx)("div",{children:"Logout"})}var he=n(223),pe=n(235),Oe=n(24),me=n(244),xe=n(245),ve=n(246),ge=n(249),Te=n(247),ke=n(248),we=n(134),ye=n.n(we),Ce=n(135),Ae=n.n(Ce),Se=n(136),Re=n.n(Se),Ee=n(133),Ie=n.n(Ee),De=n(132),Me=n.n(De),ze=n(224),Be=n(17),Fe=function(){var e=new ze.a(N);return!e.getActiveAccount()&&e.getAllAccounts().length>0&&e.setActiveAccount(e.getAllAccounts()[0]),e.enableAccountStorageEvents(),e.addEventCallback((function(t){if(t.eventType===Be.a.LOGIN_SUCCESS&&t.payload.account){var n=t.payload.account;e.setActiveAccount(n)}})),e}(),Le=n(53),Ye=function(){var e=Object(m.a)(O.a.mark((function e(t,n){var r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,He(t,n);case 2:return r=e.sent,e.next=5,r.json();case 5:r=e.sent,a=r.value;case 7:if(!r["@odata.nextLink"]){e.next=17;break}return e.next=10,He(r["@odata.nextLink"]);case 10:return r=e.sent,e.next=13,r.json();case 13:r=e.sent,a.push.apply(a,Object(Oe.a)(r.value)),e.next=7;break;case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),He=function(){var e=Object(m.a)(O.a.mark((function e(t,n){var r,a,c,i,o,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Fe.getActiveAccount()){e.next=3;break}throw Error("No active account! Verify a user has been signed in and setActiveAccount has been called.");case 3:return e.next=5,Fe.acquireTokenSilent(Object(J.a)(Object(J.a)({},P),{},{account:r}));case 5:return a=e.sent,c=new Headers(null===n||void 0===n?void 0:n.headers),i="Bearer ".concat(a.accessToken),c.append("Authorization",i),o=Object(J.a)(Object(J.a)({method:"GET"},n),{},{headers:c}),u=t.startsWith("http")?t:"".concat(V).concat(t),e.abrupt("return",fetch(u,o).catch(Ne(Fe)));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ne=function(e){return function(t){if(!(t instanceof Le.a))throw t;e.acquireTokenRedirect(Object(J.a)(Object(J.a)({},P),{},{account:e.getActiveAccount()}))}},Pe=n(39),Ve=n.n(Pe),Ze=n(130),Ue=n.n(Ze),We=n(131),Ge=n.n(We),Je="YYYY-MM-DDTHH:mmZ",qe="YYYY-MM-DDTHH:mm",$e="Europe/London",_e=[1,2,3].map((function(e){return"zoombooth".concat(e,"@socialfinance.org.uk")})),Ke=1800;Ve.a.extend(Ue.a),Ve.a.extend(Ge.a);var Qe=function(e){var t=e.day();return 0===t?e.add(1,"day"):6===t?e.add(2,"day"):e},Xe=function(e){var t=Object(J.a)({},e),n=t.value[0].availabilityView.split("");return t.occupied=n.map((function(e,n){return _e.reduce((function(e,r,a){return e+parseInt(t.value[a].availabilityView[n])}),0)})),t.available=n.map((function(e,n){return t.value.length-t.occupied[n]})),t},et=function(e){return e.map((function(e){return(e=Object(J.a)({},e)).booths=e.attendees.filter((function(e){return _e.indexOf(e.emailAddress.address.toLowerCase())>=0})),e.acceptedBooths=e.booths.filter((function(e){return e.status.response.toLowerCase().indexOf("accepted")>=0})),e}))},tt=function(e,t){var n=e.map((function(e){return(e=Object(J.a)({},e)).startTime=Ve.a.tz(e.start.dateTime,e.start.timeZone).unix(),e.endTime=Ve.a.tz(e.end.dateTime,e.end.timeZone).unix(),e.startIndex=Math.floor((e.startTime-t.startTime)/t.interval),e.endIndex=Math.ceil((e.endTime-t.startTime)/t.interval)-1,e}));return n.intervals=n.reduce((function(e,t){for(var n=t.startIndex;n<=t.endIndex;n++)e[n]=t.id;return e}),[]),n},nt=function(e){var t=e.startDate,n=e.days,a=Object(r.useState)({dates:[]}),c=Object(S.a)(a,2),i=c[0],o=c[1],u=rt(Object(m.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.dates.length>0&&at(i));case 1:case"end":return e.stop()}}),e)}))),[i]),s=Object(S.a)(u,2),l=s[0],d=s[1],j=rt(Object(m.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.dates.length>0&&ct(i));case 1:case"end":return e.stop()}}),e)}))),[i]),b=Object(S.a)(j,2),f=b[0],h=b[1];return Object(r.useEffect)((function(){o(function(e,t){for(var n=[],r=Ve()(e).hour(12).minute(0).second(0),a=t>0?t:1,c=0;c<a;c++)r=Qe(r),n.push({date:r.format("YYYY-MM-DD"),noon:r.hour(12).unix(),startTime:r.hour(8).unix(),endTime:r.hour(19).unix()}),r=r.add(1,"days");var i={dates:n,startTime:n[0].startTime,endTime:n[n.length-1].endTime,interval:Ke};return i.intervalCount=(i.endTime-i.startTime)/Ke,i.intervals=Array(Math.ceil(i.intervalCount)).fill(0).map((function(e,t){return i.startTime+t*Ke})),i.datesIndexes=n.map((function(e){return i.intervals.map((function(t,n){return t>=e.startTime&&t<e.endTime?n:-1})).filter((function(e){return e>=0}))})),i}(t,n))}),[t,n]),Object(r.useEffect)((function(){d()}),[d]),Object(r.useEffect)((function(){h()}),[h]),Object(r.useMemo)((function(){return{dates:i,boothData:l,calendarData:f,refresh:function(){d(),h()}}}),[i,l,f,d,h])},rt=function(e,t){var n=Object(r.useState)(null),a=Object(S.a)(n,2),c=a[0],i=a[1];return[c,Object(r.useCallback)((function(){e&&e().then((function(e){return i(e)}))}),Object(Oe.a)(t))]},at=function(){var e=Object(m.a)(O.a.mark((function e(t){var n,r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/me/calendar/getSchedule",n={"Content-Type":"application/json"},r={schedules:_e,startTime:{dateTime:Ve.a.unix(t.startTime).tz($e).format(qe),timeZone:$e},endTime:{dateTime:Ve.a.unix(t.endTime).tz($e).format(qe),timeZone:$e},availabilityViewInterval:Math.round(30)},e.next=5,He("/me/calendar/getSchedule",{method:"POST",headers:n,body:JSON.stringify(r)});case 5:return a=e.sent,e.t0=Xe,e.next=9,a.json();case 9:return e.t1=e.sent,e.t2=t,e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ct=function(){var e=Object(m.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/me/calendar/calendarView?"+"startDateTime=".concat(encodeURIComponent(Ve.a.unix(t.startTime).format(Je)),"&")+"endDateTime=".concat(encodeURIComponent(Ve.a.unix(t.endTime).format(Je)),"&")+"$select=start,end,subject,attendees&$top=50",e.t0=et,e.next=4,Ye(n);case 4:return e.t1=e.sent,r=(0,e.t0)(e.t1).filter((function(e){return e.acceptedBooths.length>0})),e.abrupt("return",tt(r,t));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),it=function(){var e=Object(m.a)(O.a.mark((function e(t,n,r){var a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/me/calendar/events",a={"Content-Type":"application/json"},c={subject:"Booth Booking",start:{dateTime:Ve.a.unix(n).tz($e).format(Je),timeZone:$e},end:{dateTime:Ve.a.unix(r).tz($e).add(Ke,"seconds").format(Je),timeZone:$e},attendees:[{emailAddress:{address:t}}]},e.next=5,He("/me/calendar/events",{method:"POST",headers:a,body:JSON.stringify(c)});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ot=function(){var e=Object(m.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/me/calendar/events/".concat(t),e.next=3,He(n,{method:"DELETE"});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ut=["#EF9A9A","#FFCC80","#FFF59D"],st=function(e){var t=e.calendarService,n=Object(r.useState)([]),a=Object(S.a)(n,2),c=a[0],i=a[1],o=Object(r.useState)([]),u=Object(S.a)(o,2),s=u[0],l=u[1],d=t.dates,j=t.boothData,b=t.calendarData,f=t.refresh,h=Object(r.useCallback)((function(e){var t=c.indexOf(e),n=Object(Oe.a)(c);t<0?(n.push(e),n.sort((function(e,t){return e-t}))):n.splice(t,1);var r=Array(n.length).fill(-1).map((function(e,t){var r=n[t]-1;return n.indexOf(r)})).reduce((function(e,t,r,a){return t<0?e.push([n[r]]):e[e.length-1].push(n[r]),e}),[]).map((function(e,t){return{start:d.intervals[e[0]],end:d.intervals[e[e.length-1]],cells:e}}));i(n),l(r)}),[c,d]),p=Object(r.useCallback)((function(e){it(_e[0],e.start,e.end).then((function(t){f(),i(c.filter((function(t){return!e.cells.includes(t)})))}))}),[f,c]),O=Object(r.useMemo)((function(){return d&&d.datesIndexes?d.datesIndexes[0].map((function(e){return{time:d.intervals[e],days:d.datesIndexes.map((function(t){var n=t[e];return{timeslot:n,available:j?j.available[n]:-1,events:b?b.intervals[n]:-1,selected:c.indexOf(n)>=0}}))}})):[]}),[d,j,b,c]);return console.log("calendarView",O),Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(me.a,{component:pe.a,children:Object(R.jsxs)(xe.a,{sx:{minWidth:250},size:"small",children:[Object(R.jsx)(ve.a,{children:Object(R.jsxs)(Te.a,{children:[Object(R.jsx)(ke.a,{children:"Time"}),d.dates.map((function(e){return Object(R.jsx)(ke.a,{align:"center",children:Ve.a.unix(e.noon).format("ddd, D MMM")},e.noon)}))]})}),Object(R.jsx)(ge.a,{children:O.map((function(e,t){var n=t%2===0?0:"1px solid #eee";return Object(R.jsxs)(Te.a,{sx:{"td,th":{borderBottom:n,borderRight:"1px solid #eee"},"&:last-child td, &:last-child th":{borderBottom:0}},children:[Object(R.jsx)(ke.a,{component:"th",scope:"row",children:Ve.a.unix(e.time).format("HH:mm")}),e.days.map((function(e){var t=function(e){if(e.selected)return["#CCC",Me.a];if(void 0!==e.events&&-1!==e.events)return["#00F",Ie.a];var t=e.available>=ut.length?"#A5D6A7":ut[e.available];return 0===e.available?[t,ye.a]:e.available<=2?[t,Ae.a]:[t,Re.a]}(e),n=Object(S.a)(t,2),r=n[0],a=n[1];return Object(R.jsx)(ke.a,{sx:{backgroundColor:r},onClick:function(){return h(e.timeslot)},align:"center",children:Object(R.jsx)(a,{})},e.timeslot)}))]},e.time)}))})]})}),s&&s.map((function(e,t){return Object(R.jsx)(pe.a,{children:Object(R.jsx)(I.a,{onClick:function(){return p(e)},children:"Book"})},t)}))]})},lt=function(){return Object(R.jsx)(C.a,{variant:"h6",children:"Authentication in progress..."})},dt=function(e){var t=e.error;return Object(R.jsxs)(C.a,{variant:"h6",children:["An Error Occurred: ",t.errorCode]})},jt=function(){var e=Object(l.c)("date",l.b),t=Object(S.a)(e,1)[0],n=Object(he.a)("(min-width:750px)"),a=nt({startDate:t,days:n?5:1});Object(r.useEffect)((function(){var e=setTimeout((function(){return a.refresh()}),3e4);return function(){clearTimeout(e)}}),[a]);var c=Object(r.useCallback)(function(){var e=Object(m.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot(t);case 2:a.refresh();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a]);return Object(R.jsx)(pe.a,{children:a&&Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(st,{calendarService:a}),Object(R.jsx)(I.a,{onClick:a.refresh,children:"Refresh"}),a.calendarData&&a.calendarData.map((function(e){return Object(R.jsx)("li",{children:Object(R.jsxs)(I.a,{onClick:function(){return c(e.id)},children:["Cancel ",e.subject]})},e.id)}))]})})};function bt(){var e=Object(J.a)({},P);return Object(R.jsx)(h.a,{interactionType:oe.h.Redirect,authenticationRequest:e,errorComponent:dt,loadingComponent:lt,children:Object(R.jsx)(jt,{})})}function ft(){return Object(R.jsxs)(u.c,{children:[Object(R.jsx)(u.a,{path:"/logout",children:Object(R.jsx)(fe,{})}),Object(R.jsx)(u.a,{path:"/",children:Object(R.jsx)(bt,{})})]})}var ht=function(e){var t=e.pca,n=Object(u.f)(),r=new k(n);return t.setNavigationClient(r),Object(R.jsx)(h.b,{instance:t,children:Object(R.jsx)(je,{children:Object(R.jsx)(f.a,{container:!0,justifyContent:"center",children:Object(R.jsx)(ft,{})})})})};i.a.render(Object(R.jsx)(a.a.StrictMode,{children:Object(R.jsx)(o.a,{children:Object(R.jsx)(s.a,{theme:b,children:Object(R.jsx)(l.a,{ReactRouterRoute:u.a,children:Object(R.jsx)(ht,{pca:Fe})})})})}),document.getElementById("root"))}},[[164,1,2]]]);
//# sourceMappingURL=main.670bfa92.chunk.js.map